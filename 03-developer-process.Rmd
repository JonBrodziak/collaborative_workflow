# Contributor Guidelines

External contributions and feedback are important to the development and future maintenance of FIMS and are welcome. This section provides information for FIMS developers and collaborators on how to contribute to the project.

## FIMS Branching Strategy

There are several [branching strategies](https://reviewpad.com/blog/github-flow-trunk-based-development-and-code-reviews/) available that will work within the Git environment and other version control systems. However, it is important to find a strategy that works well for both current and future contributors. Branching strategies provide guidance for how, when, and why branches are created and named, which also ties into necessary guidance surrounding issue tracking. 

The FIMS Project uses a [Scaled Trunk Based Development](https://trunkbaseddevelopment.com/) branching strategy to make tasks easier without compromising quality. 
![Scaled Trunk Based Development; image credit: https://reviewpad.com/blog/github-flow-trunk-based-development-and-code-reviews/](https://reviewpad.com/wp-content/uploads/2021/06/Scaled-Trunk-Based-Development.svg)
This  strategy is required for continuous integration and facilitates knowledge of steps that must be taken prior to, during, and after making changes to the code, while still allowing anyone interested in the code to read it at any time. Additionally, trunk-based development captures the following needs without being overly complicated:

* Short-lived branches to minimize stale code and merge conflicts
* Fast release times, especially for bug fixes
* Ability to release bug fixes without new features

### Branching Good Practices

The following suggestions will help ensure optimal performance of the trunk-based branching strategy:

1. Branches and commits should be kept small (e.g. a couple commits, a few lines of code) to allow for rapid merges and deployments. 
2. Use [feature flags](https://martinfowler.com/articles/feature-toggles.html) to wrap new changes in an inactive code path for later activation (rather than creating a separate repository feature branch).
3. Delete branches after it is merged to the trunk; avoid repositories with a large number of "active" branches.
4. Merge branches to the trunk frequently (e.g. **at least** every few days; tag as a release commit) to avoid merge conflicts.
5. Use caching layers where appropriate to optimize build and test execution times. 

### Branch Protection

Branch protection allows for searching branch names with `grep` functionality to apply merging rules (i.e., protection). This will be helpful to protect the main/trunk branch such that pull requests cannot be merged in prior to passing various checks or by individuals without the authority to do so.

## Issue Tracking

Use of the GitHub issue tracker is key to keeping everyone informed and prioritizing key tasks. All future projects, ideas, concerns, development, 
etc. must be documented in an issue before the code is altered. Issues should be filed and tagged prior to any code changes whether the change 
pertains to a bug or the development of a feature. At a minimum, all issues will be labeled with a future version number. Bugs with immediate fixes will 
be assigned to the current version number augmented for a hot fix and development will be based on code in the trunk. All other issues will be 
assigned to a future version and development will be based on version branches. That is, changes to the code for version 3.3 cannot start until there is a branch 
for version 3.3. This will minimize stale code and large merge conflicts.

### Issue Templates

To be developed (e.g. report bug, request enhancement, maintenance/feature dev)...

## Pull Requests

Pull requests are used to identify changes pushed to development branches. Open pull requests allow the FIMS Development Team to discuss and review the changes, as well as add follow-up commits before merging to the main branch. As noted above in the branching stratgegy section, branches, commits, and pull requests should be kept small to enable rapid review and reduce the chance of merge conflicts. Any pull requests for the FIMS Project must be fully tested and reviewed before being merged into the main branch. 

## Coding Good Practices

Following good software development and coding practices simplifies collaboration and streamlines testing and review. The following are industry-accepted standards:

* Use meaningful variable names that are easy to understand and clearly represent the data they store
* Use descriptive titles and consistent conventions for class and function names
* Add clear and concise coding comments
* Use consistent formatting and indentation to improve readability and organization
* Avoid hard-coded values to ensure portability of your code
* Follow the DRY principle - "Don't Repeat Yourself" (or your code)
* Avoid deep nesting
* Limit line length (wrap ~72 characters)

## Commit Messages

FIMS Project contributors should provide clear, descriptive commit messages to communicate to collaborators details about changes that have occurred and improve team efficiency. Good commit messages follow the following practices:

* Include a short summary of the change for the subject/title (<50 characters)
    * Include a blank line in between the 'subject' and 'body'
    * Specify the type of commit:
          * *fix*: bug fix
          * *feat*: new feature
          * *test*: testing
          * *docs*: documentation
          * *chore*: regular code maintenance (e.g. updating dependencies)
          * *refactor*: refactoring codebase
          * *style*: changes that do not affect the meaning of the code; instead address code styling/formmatting
          * *perf*: performance improvements
          * *revert*: reverts a previous commit
          * *build*: changes that affect the build system
    * If the commit addresses an issue, indicate the issue# in the title
* Provide a brief explanatory description of the change, addressing what and why was changed
    * Wrap to ~72 characters
    * Write in the imperative (e.g. "Fix bug", not "Fixed bug")
    * If necessary, separate paragraphs by blank lines
    * Utilize `BREAKING CHANGE: <description>` to provide expanation or further context about the issue being addressed. 
    * If the commit closes an issue, include a footer to note that (i.e. "Closes #19")

## Code Review

Code review ensures health and continuous improvement of the FIMS codebase, while simultaneously helping FIMS developers become familiar with the codebase and ensure there is a diverse team of knolwedgable collaborators to support the continued development and maintenance of FIMS. CI/CD requires rapid review of all new/modified code, so processes must be in place to support this pace. FIMS code review will utilize tools available via [GitHub](https://github.com/features/code-review), which allows reviewers to analyze code changes, provide inline comments, and view change histories.

### Assigning Reviewers

Reviewers for the FIMS Project may be assigned in two different ways: 

1. A specific member of the FIMS Development Team is requested to review a pull request, based on their specific expertise.
2. Code review assignments are automatically assigned using the [GitHub load balance routing algorithm](https://docs.github.com/en/organizations/organizing-members-into-teams/managing-code-review-settings-for-your-team); this approach tries to ensure that each team member reviews an equal number of pull request in any 30 day period.

Team members should keep their status in Github current (see ["Setting a status"](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-profile/customizing-your-profile/personalizing-your-profile#setting-a-status) for more information). Reviews will not be auto-assigned to "Busy" team members. 

If a review has been assigned to you and you don't feel like you have the expertise to address it properly, please respond directly to the code owner immediately so a different reviewer can be found promptly. 

### Automated Testing

Automated testing provides an initial layer of quality assurance and lets reviewers know that the code meets certain standards. For more on FIMS testing, see [Chapter 6](https://noaa-fims.github.io/collaborative_workflow/test-case-template.html).

### Review Criteria

While automated testing can assure the code structure and logic pass quality checks, human reviewers are required to evaluate things like functionality, readability, etc. Reviewers should evaluate the code critically and provide comment/feedback on the following items:

**Readability**
* Is the code easy to understand?
* Are there any parts of the code that are confusing?
* Is the data flow easy to understand?
* Is there any code commented out?
* Does the code include any unclear names?
* Does the code include any errors, repeats, or incomplete sections?

**Functionality**
* Does the code function as it is expected to?
* How will the change impact other parts of the system?
* Are there any unhandled edge cases?
* Are there other code improvements possible?

**Design**
* Are files organized intuitively?
* Are components divided up in a sensible way?
* Does the review include too many changes? Would the code change better be broken into more focused parts?
* Will the change be easy to maintain?
* Does the code follow object-oriented design principles?
* Is the code in the proper location?

**Security**
* Does using this code open the software to possible security violations or vulnerabilities?
* Is the correct encryption used?

**Performance**
* Are there ways to improve on the code's performance?
* Is there any complex logic that could be simplified?
* Could any of the code be replaced with built-in functions?
* Will this change have any impacts on system performance?
* Is there any debugging code that could be removed?
* Are there any optimizations that could be removed and still maintain system performance?

**Documentation**
* Are there comments available to explain the code?
* Is the README file complete and current? Does it adequately describe the project/changes?

**Testing**
* Is the code testable?
* Is the automated testing adequate?
* Have dependencies been appropriately tested?
* Does automated testing cover the code exchange adequately?
* Could the test structure be improved?

### Review Good Practices

Good reviews require good review habits. Try to follow these suggestions:

* Review in short sessions (< 60 minutes) to maintain focus and attention to detail
* Don't try to review more than 400 lines of code in a single session
* Provide constructive and supportive feedback
      * Ask open-ended questions and offer alternatives or possible workarounds
      * Avoid strong/opinionated statements
      * Applaud good solutions
      * Don't say "you"
* Be clear about which questions/comments are non-blocking or unimportant; likewise, be explicit when approving a change or requesting follow-up
      * Aim to minimize the number of nitpicks (if there are a lot, suggest a team-level resolution)
* Use the [FIMS Style Guide](https://noaa-fims.github.io/collaborative_workflow/style-guide.html) to settle any style arguments

## External Collaborators

External collaborators interested in contributing to FIMS development are required to fork the FIMS repository, make changes, and submit a pull request. However, collaborators are strongly encouraged to submit an issue via the main FIMS repository for discussion prior to forking. In general, forks are discouraged for everyday development as it becomes difficult to keep track of multiple forks. 

Pull requests from forks will be reviewed the same as a pull request submitted from a branch. Users will need to conform to the same standards and all contributions must pass the standard tests as well as provide tests that check the new feature.
